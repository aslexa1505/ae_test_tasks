# Сервис для работы с пользователями на NestJS

## Описание

Этот проект реализует сервис на NestJS, который работает с пользователями в базе данных. В базе данных хранится более 1 миллиона пользователей. Каждый пользователь имеет следующие поля:

- **Имя**
- **Фамилия**
- **Возраст**
- **Пол**
- **Проблемы** (`problems`): булево значение, указывающее, есть ли проблемы у пользователя.

Сервис предоставляет эндпоинт, который устанавливает флаг `problems` в `false` для всех пользователей и возвращает количество пользователей, у которых этот флаг был установлен в `true` до обновления.

## Установка и запуск

### Предварительные требования

- **Node.js** версии **14.x** или выше
- **npm** версии **6.x** или выше
- **PostgreSQL** версии **10.x** или выше

### Шаги установки

1. **Клонируйте репозиторий**

   ```bash
   git clone https://github.com/your-repository/user-service.git
   cd user-service
    ```
    
2. **Установите зависимости**

    ```bash
   git clone https://github.com/your-repository/user-service.git
   cd user-service
    ```
    
3. **Настройте подключение к базе данных**
    Отредактируйте файл ormconfig.js и укажите ваши настройки базы данных:
    ```bash
    module.exports = {
      type: 'postgres',
      host: 'localhost',
      port: 5432,
      username: 'your_username',
      password: 'your_password',
      database: 'your_database',
      entities: ['dist/**/*.entity{.ts,.js}'],
      migrations: ['dist/migrations/*{.ts,.js}'],
      cli: {
        migrationsDir: 'src/migrations',
      },
    };
    ```
    Также убедитесь, что настройки в app.module.ts соответствуют вашим параметрам.
    
4. **Скомпилируйте проект**

    ```bash
    npm run build
    ```
    
5. **Скомпилируйте проект**

    ```bash
    npm run typeorm migration:run
    ```
    Примечание: Миграция создаст более 1 миллиона пользователей. Этот процесс может занять несколько минут.
6. **Скомпилируйте проект**

    ```bash
    npm run start
    ```
    Приложение будет доступно по адресу http://localhost:3000.
    
### Использование
#### Эндпоинт для сброса флага problems
- **URL:** http://localhost:3000/users/reset-problems
- **Метод:** POST
- **Описание:** Устанавливает флаг problems в false для всех пользователей и возвращает количество пользователей, у которых этот флаг был true до обновления.

**Пример запроса с использованием curl**
```bash
curl -X POST http://localhost:3000/users/reset-problems
```
**Пример ответа**
```json
{
  "updated": true,
  "previousTrueCount": 500123
}
```

### Примечания
- **Производительность:** При работе с большим количеством данных важно оптимизировать запросы и использовать индексы. В данном проекте на поле problems установлен индекс для ускорения операций.
- **Конфигурация:** Убедитесь, что все конфигурационные файлы настроены правильно и не содержат конфиденциальной информации, такой как пароли.
- **Обработка ошибок:** Добавьте обработку ошибок и исключений по мере необходимости для повышения надежности приложения.